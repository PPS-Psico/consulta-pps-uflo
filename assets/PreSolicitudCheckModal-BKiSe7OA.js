import{bI as q,j as e,M as F,R as U,r as p,n as I,K as R,a0 as H,Y as J,N as L,z as V,k as B,bJ as K,f as W,g as Z,i as Q,C as G,as as T,T as Y,bZ as X,b_ as ee,ar as ae}from"./index-Dt1aWOFI.js";const te=({isOpen:o,onClose:n,onConfirm:r,criterios:t,informeTask:l})=>o?q.createPortal(e.jsx("div",{className:"fixed inset-0 z-[1300] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in",onClick:n,children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden border border-slate-200 dark:border-slate-700",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/50",children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx("span",{className:"material-icons text-emerald-600 dark:text-emerald-400",children:"check_circle"}),"Confirmar Criterios de Acreditación"]}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"Verifica los criterios antes de continuar"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-700 dark:text-slate-300",children:"Horas Objetivo"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:["Obtenidas:"," ",e.jsx("span",{className:"font-medium text-slate-900 dark:text-white",children:t.horasTotales})]}),e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:["Total:"," ",e.jsx("span",{className:"font-medium text-slate-900 dark:text-white",children:t.horasTotales})]})]}),e.jsx("div",{className:"p-3 rounded-lg bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:e.jsx("p",{className:"text-sm font-semibold text-green-700 dark:text-green-400",children:"Criterio Cumplido"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-700 dark:text-slate-300",children:"Informe de Práctica"}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx("strong",{children:"Práctica:"})," ",l.ppsName]}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-500 mt-2",children:"Este informe se generará automáticamente y será enviado al estudiante."})]})]})]}),e.jsxs("div",{className:"p-6 flex justify-between border-t border-slate-200 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/50",children:[e.jsx("button",{onClick:n,className:"px-6 py-2 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-300 dark:hover:bg-slate-600 rounded-lg font-medium transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:r,className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors",children:"Confirmar"})]})]})}),document.body):null;function se(o,n){let r=0;const t=new Date(o);let l=0;for(;r<n&&l<365;){t.setDate(t.getDate()+1);const x=t.getDay(),g=t.getMonth();!(x===0||x===6)&&!(g===0)&&r++,l++}return t}function O(o,n){if(o>n)return-O(n,o);let r=0;const t=new Date(o),l=new Date(n);l.setHours(0,0,0,0),t.setHours(0,0,0,0);let x=0;for(;t<l&&x<365;){t.setDate(t.getDate()+1);const g=t.getDay(),b=t.getMonth();!(g===0||g===6)&&!(b===0)&&r++,x++}return r}const le=({status:o,requestDate:n,studentName:r})=>{const t=new Date(n),l=se(t,14),x=new Date,b=x.getMonth()===0,v=(s=>(s==null?void 0:s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim())||"")(o),h=v==="cargado"||v==="finalizada",k=v==="en proceso",S=O(x,l),m=b,P=l.getTime()-t.getTime(),D=x.getTime()-t.getTime();let C=Math.min(100,Math.max(5,D/P*100));m&&(C=Math.min(C,95)),S<0&&(C=100);const N=(r==null?void 0:r.split(" ")[0])||"Estudiante",j=S<0&&!h&&!m,w=e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-blue-600 via-indigo-500 to-purple-600 dark:from-blue-400 dark:via-indigo-400 dark:to-purple-400",children:N});if(h)return e.jsx("div",{className:"w-full animate-fade-in-up mb-8",children:e.jsxs("div",{className:"relative overflow-hidden rounded-[2.5rem] bg-emerald-50/80 dark:bg-emerald-950/20 border border-emerald-100 dark:border-emerald-800 p-10 sm:p-16 shadow-2xl shadow-emerald-100/50 dark:shadow-none text-center backdrop-blur-xl",children:[e.jsx("div",{className:"absolute top-0 right-0 -mt-20 -mr-20 h-96 w-96 rounded-full bg-emerald-100/40 dark:bg-emerald-900/10 blur-3xl pointer-events-none"}),e.jsx("div",{className:"absolute bottom-0 left-0 -mb-20 -ml-20 h-64 w-64 rounded-full bg-teal-100/40 dark:bg-teal-900/10 blur-3xl pointer-events-none"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center gap-8",children:[e.jsx("div",{className:"h-24 w-24 bg-white dark:bg-slate-900 rounded-full flex items-center justify-center shadow-lg animate-bounce-slow text-emerald-500 dark:text-emerald-400 border border-emerald-100 dark:border-emerald-800/50",children:e.jsx("span",{className:"material-icons !text-5xl",children:"verified"})}),e.jsxs("div",{className:"space-y-4 max-w-3xl",children:[e.jsxs("h1",{className:"text-5xl sm:text-6xl font-black tracking-tighter text-slate-900 dark:text-white drop-shadow-sm leading-tight",children:["¡Todo listo, ",w,"!"]}),e.jsxs("p",{className:"text-xl text-slate-600 dark:text-slate-300 font-medium leading-relaxed",children:["Tu acreditación ha sido completada exitosamente. ",e.jsx("br",{className:"hidden sm:block"}),"Tus horas de PPS ya se encuentran cargadas en el sistema académico SAC."]})]}),e.jsx("div",{className:"mt-6",children:e.jsxs("a",{href:"https://alumno.uflo.edu.ar",target:"_blank",rel:"noopener noreferrer",className:"group inline-flex items-center gap-3 px-10 py-4 bg-slate-900 dark:bg-white text-white dark:text-slate-900 font-bold text-lg rounded-2xl shadow-xl hover:shadow-2xl hover:shadow-indigo-500/20 hover:-translate-y-1 transition-all duration-300",children:[e.jsx("span",{children:"Verificar en SAC"}),e.jsx("span",{className:"material-icons !text-2xl group-hover:translate-x-1 transition-transform",children:"open_in_new"})]})})]})]})});let E=()=>e.jsx("span",{className:"text-slate-900 dark:text-white",children:"¡Solicitud Recibida!"}),_="Estamos evaluando tu solicitud y validando la documentación presentada. Este proceso es manual y requiere revisión por parte de coordinación.",a="Solicitud Enviada",d="text-blue-600 bg-blue-100 dark:text-blue-300 dark:bg-blue-900/30 border-blue-200 dark:border-blue-800",i=0;k&&(E=()=>e.jsxs(e.Fragment,{children:["Todo marcha bien, ",w,"."]}),_="Tus documentos fueron validados correctamente y el expediente se encuentra en el circuito de acreditación interna.",a="En Proceso",d="text-indigo-600 bg-indigo-100 dark:text-indigo-300 dark:bg-indigo-900/30 border-indigo-200 dark:border-indigo-800",i=1);const c=[{title:"Validación Documental",desc:"Revisión de firmas y planillas.",icon:"inventory_2"},{title:"Circuito Administrativo",desc:"Aprobación final por áreas UFLO.",icon:"settings_suggest"},{title:"Acreditación Final",desc:"Carga definitiva en sistema SAC.",icon:"school"}];return e.jsxs("div",{className:"w-full animate-fade-in-up pb-12 space-y-8",children:[e.jsxs("div",{className:"relative overflow-hidden glass-panel rounded-[3rem] shadow-xl p-8 sm:p-14 mb-8",children:[e.jsx("div",{className:"absolute top-0 right-0 w-[800px] h-[800px] bg-gradient-to-bl from-blue-100/30 to-transparent dark:from-blue-900/20 rounded-full blur-[120px] -mr-60 -mt-60 pointer-events-none"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:`inline-flex items-center gap-2 px-5 py-2 rounded-full text-xs font-black uppercase tracking-widest mb-6 border shadow-sm ${d}`,children:[e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-current opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-current"})]}),a]}),e.jsx("h2",{className:"text-4xl sm:text-5xl lg:text-6xl font-black leading-tight mb-6 tracking-tighter",children:E()}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 text-lg sm:text-xl leading-relaxed max-w-4xl font-medium",children:_})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsx("div",{className:"hidden lg:flex lg:col-span-8",children:e.jsxs("div",{className:"w-full bg-white/80 dark:bg-[#0F172A]/80 rounded-[3rem] border border-slate-200/80 dark:border-slate-800 p-10 sm:p-12 backdrop-blur-xl h-full flex flex-col shadow-lg relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500 opacity-20"}),e.jsxs("div",{className:"flex items-center gap-4 mb-8 flex-shrink-0",children:[e.jsx("div",{className:"p-3 bg-slate-100 dark:bg-slate-800 rounded-2xl text-slate-600 dark:text-slate-300 shadow-sm",children:e.jsx("span",{className:"material-icons !text-3xl",children:"timeline"})}),e.jsx("h3",{className:"font-black text-slate-800 dark:text-white text-2xl tracking-tight",children:"Etapas del Proceso"})]}),e.jsxs("div",{className:"flex-grow flex flex-col justify-between pl-4 py-4 relative",children:[e.jsx("div",{className:"absolute left-[30px] top-8 bottom-8 w-1 bg-slate-100 dark:bg-slate-800 -z-10 rounded-full"}),e.jsx("div",{className:"absolute left-[30px] top-8 w-1 bg-gradient-to-b from-emerald-400 to-blue-500 -z-10 rounded-full transition-all duration-1000",style:{height:`${i/(c.length-1)*85}%`}}),c.map((s,u)=>{const y=u<i,A=u===i,z=u>i;return e.jsxs("div",{className:`relative flex items-center gap-8 ${z?"opacity-50 grayscale":"opacity-100"}`,children:[e.jsx("div",{className:`flex-shrink-0 w-16 h-16 rounded-full border-[6px] flex items-center justify-center z-10 transition-all duration-500
                                            ${y?"bg-emerald-500 border-white dark:border-slate-900 text-white shadow-xl shadow-emerald-500/30":A?"bg-white dark:bg-slate-900 border-blue-500 text-blue-600 shadow-2xl ring-4 ring-blue-100 dark:ring-blue-900/30 scale-110":"bg-slate-100 dark:bg-slate-800 border-white dark:border-slate-900 text-slate-400"}
                                        `,children:e.jsx("span",{className:`material-icons !text-2xl ${A?"animate-pulse":""}`,children:y?"check":s.icon})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("h4",{className:`text-xl font-black tracking-tight ${A?"text-blue-700 dark:text-blue-400":y?"text-emerald-700 dark:text-emerald-400":"text-slate-500"}`,children:s.title}),y&&e.jsx("span",{className:"text-[9px] bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-md font-black uppercase tracking-widest",children:"OK"}),A&&e.jsx("span",{className:"text-[9px] bg-blue-100 text-blue-700 px-2 py-0.5 rounded-md font-black uppercase tracking-widest animate-pulse",children:"EN CURSO"})]}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 text-base font-medium leading-relaxed max-w-md",children:s.desc})]})]},u)})]})]})}),e.jsxs("div",{className:"col-span-1 lg:col-span-4 flex flex-col gap-6",children:[e.jsxs("div",{className:"glass-panel rounded-[3rem] shadow-xl overflow-hidden flex flex-col p-10",children:[e.jsx("h3",{className:"font-bold text-slate-500 text-xs uppercase tracking-widest mb-6",children:"Tiempo de Resolución"}),m&&e.jsxs("div",{className:"mb-6 p-4 bg-amber-50 dark:bg-amber-900/20 border border-amber-100 dark:border-amber-800/50 rounded-2xl flex items-start gap-3",children:[e.jsx("span",{className:"material-icons text-amber-500 mt-0.5 !text-xl",children:"beach_access"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-black text-amber-800 dark:text-amber-200 uppercase mb-1",children:"Receso de Verano"}),e.jsx("p",{className:"text-xs text-amber-700 dark:text-amber-300 leading-tight",children:"Enero no computa plazos administrativos."})]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center mb-8",children:[e.jsx("span",{className:`text-8xl font-black tracking-tighter leading-none ${j?"text-rose-500":m?"text-amber-500":"text-slate-900 dark:text-white"}`,children:m?"~":Math.max(0,S)}),e.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-[0.2em] mt-3",children:m?"En Pausa":"Días Hábiles"})]}),e.jsx("div",{className:"w-full bg-slate-100 dark:bg-slate-800 rounded-full h-3 mb-8 overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-1000 ${m?"bg-amber-400 striped-bar":j?"bg-rose-500":"bg-blue-600"}`,style:{width:`${C}%`}})}),e.jsxs("div",{className:"flex justify-between items-center text-center",children:[e.jsxs("div",{className:"flex-1 border-r border-slate-100 dark:border-slate-800",children:[e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase mb-1",children:"Enviado"}),e.jsx("p",{className:"text-sm font-bold text-slate-700 dark:text-slate-300 font-mono",children:F(t.toISOString())})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase mb-1",children:"Estimado"}),e.jsx("p",{className:`text-sm font-bold font-mono ${j?"text-rose-500":"text-slate-700 dark:text-slate-300"}`,children:F(l.toISOString())})]})]})]}),e.jsxs("div",{className:"glass-panel rounded-[3rem] p-10 shadow-xl border border-slate-200 dark:border-slate-700 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-blue-50 dark:bg-blue-500/10 rounded-full blur-3xl -mr-10 -mt-10"}),e.jsx("h3",{className:"font-bold text-slate-400 dark:text-slate-500 text-[10px] uppercase tracking-[0.2em] mb-4",children:"Soporte y Consultas"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 mb-6 leading-relaxed font-medium",children:"Si el plazo de resolución ya venció y no visualizas tus horas, contacta a coordinación."}),e.jsxs("a",{href:j?`mailto:blas.rivera@uflouniversidad.edu.ar?subject=Consulta Acreditación - ${N}`:void 0,className:`w-full flex items-center justify-center gap-3 py-4 rounded-2xl font-bold transition-all ${j?"bg-blue-600 hover:bg-blue-500 text-white shadow-lg shadow-blue-500/20":"bg-slate-100 dark:bg-slate-700 text-slate-400 dark:text-slate-500 border border-slate-200 dark:border-slate-600 cursor-not-allowed"}`,children:[e.jsx("span",{className:"material-icons",children:j?"mail":"lock_clock"}),e.jsx("span",{children:j?"Contactar Coordinación":"Consulta Bloqueada"})]})]})]})]})]})},M=({solicitud:o})=>{const n=o[V]||"",r=o[R]||"Pendiente",t=o[B],l=K(r);return e.jsx("div",{className:"relative group bg-white dark:bg-slate-800/40 rounded-xl p-4 border border-slate-200/60 dark:border-slate-700/60 hover:border-blue-300 dark:hover:border-blue-700 transition-all duration-300",children:e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 justify-between sm:items-center",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`flex-shrink-0 w-12 h-12 rounded-xl flex items-center justify-center ${l.iconContainerClass.replace("border","")} bg-opacity-20 dark:bg-opacity-10`,children:e.jsx("span",{className:`material-icons !text-2xl ${l.accentBg.replace("bg-","text-")}`,children:l.icon})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-800 dark:text-slate-100 text-base leading-tight",children:n||"Institución sin nombre"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1",children:[e.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide border ${l.labelClass}`,children:r}),e.jsx("span",{className:"text-xs text-slate-400",children:"•"}),e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1",children:[e.jsx("span",{className:"material-icons !text-[10px]",children:"update"}),F(t)]})]})]})]})})})},$=({icon:o,title:n,description:r,onClick:t,colorScheme:l,className:x=""})=>{const g={blue:"bg-blue-50 text-blue-700 border-blue-200 hover:bg-blue-100 dark:bg-blue-900/20 dark:text-blue-300 dark:border-blue-800",teal:"bg-teal-50 text-teal-700 border-teal-200 hover:bg-teal-100 dark:bg-teal-900/20 dark:text-teal-300 dark:border-teal-800",slate:"bg-slate-50 text-slate-600 border-slate-200 cursor-not-allowed dark:bg-slate-800 dark:text-slate-400 dark:border-slate-700"};return e.jsxs("button",{type:"button",onClick:t,className:`w-full flex items-center gap-4 p-4 rounded-xl border transition-all duration-300 text-left group ${g[l]} ${x}`,children:[e.jsx("div",{className:"p-2 bg-white dark:bg-slate-900 rounded-lg shadow-sm",children:e.jsx("span",{className:"material-icons !text-2xl",children:o})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-sm",children:n}),e.jsx("p",{className:"text-xs opacity-80 mt-0.5",children:r})]}),l!=="slate"&&e.jsx("div",{className:"ml-auto opacity-0 group-hover:opacity-100 transition-opacity transform translate-x-[-10px] group-hover:translate-x-0 duration-300",children:e.jsx("span",{className:"material-icons",children:"arrow_forward"})})]})},re=({solicitudes:o,onCreateSolicitud:n,onRequestFinalization:r,criterios:t,finalizacionRequest:l,informeTasks:x=[]})=>{const[g,b]=p.useState(!1),f=p.useMemo(()=>x.some(m=>m.informeSubido&&(m.nota==="Sin calificar"||m.nota==="Entregado (sin corregir)")),[x]),v=t?t.cumpleHorasTotales&&t.cumpleRotacion&&t.cumpleHorasOrientacion&&!t.tienePracticasPendientes&&!f:!1,{activeRequests:h,historyRequests:k}=p.useMemo(()=>{const m=[],P=[],D=["finalizada","cancelada","rechazada","no se pudo concretar","pps realizada","solicitud invalida","realizada"],C=["archivado"];return o.forEach(N=>{const j=I(N[R]);C.includes(j)||(D.some(w=>j.includes(w))?P.push(N):m.push(N))}),{activeRequests:m,historyRequests:P}},[o]),S=()=>{r&&b(!0)};return e.jsxs("div",{className:"space-y-6",children:[l&&e.jsx(le,{status:l[J]||"Pendiente",requestDate:l[H]||l.created_at||""}),!l&&(n||r)&&e.jsxs("div",{className:"grid grid-cols-1 gap-4 mb-2",children:[n&&e.jsx($,{icon:"add_business",title:"Nueva Solicitud de PPS",description:"Inicia un trámite de autogestión.",onClick:n,colorScheme:"blue"}),r&&e.jsx("div",{className:"md:hidden",children:e.jsx($,{icon:v?"verified":"lock_clock",title:"Trámite de Acreditación",description:v?"Requisitos cumplidos. Iniciar cierre.":"Faltan requisitos. Toca para ver detalles.",onClick:S,colorScheme:v?"teal":"slate"})})]}),t&&e.jsx(te,{isOpen:g,onClose:()=>b(!1),onConfirm:()=>{r&&r(),b(!1)},criterios:t,informeTask:x[0]}),h.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider pl-1",children:["Gestiones en Curso (",h.length,")"]}),e.jsx("div",{className:"flex flex-col gap-3",children:h.map(m=>e.jsx(M,{solicitud:m},m.id))})]}),k.length>0&&e.jsxs("details",{className:"group pt-4 border-t border-slate-200 dark:border-slate-800",children:[e.jsxs("summary",{className:"flex items-center gap-2 cursor-pointer list-none text-sm font-bold text-slate-500 hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200 transition-colors py-2",children:[e.jsx("span",{className:"material-icons transition-transform group-open:rotate-90 text-slate-400 !text-lg",children:"history"}),"Ver Historial (",k.length,")"]}),e.jsx("div",{className:"mt-3 flex flex-col gap-3 pl-2 border-l-2 border-slate-100 dark:border-slate-800",children:k.map(m=>e.jsx(M,{solicitud:m},m.id))})]}),h.length===0&&k.length===0&&!l&&e.jsx(L,{icon:"list_alt",title:"Sin Solicitudes",message:"No tienes trámites de PPS registrados actualmente.",className:"bg-transparent border-none shadow-none p-0 mt-8"})]})},ne=U.memo(re),de=({studentAirtableId:o,onClose:n})=>{const{showToast:r}=W(),[t,l]=p.useState(!1),[x,g]=p.useState(!1),[b,f]=p.useState(null),v=Z(),[h,k]=p.useState({horas:{files:[],uploading:!1,uploadedData:[]},asistencia:{files:[],uploading:!1,uploadedData:[]},informe:{files:[],uploading:!1,uploadedData:[]}}),[S,m]=p.useState(""),P={horas:p.useRef(null),asistencia:p.useRef(null),informe:p.useRef(null)},D=(a,d)=>{if(!a||a.length===0)return;const i=[];for(let c=0;c<a.length;c++){const s=a[c];if(s.size>10*1024*1024){r(`El archivo ${s.name} es demasiado grande (máx 10MB).`,"error");continue}i.push(s)}k(c=>{const u=d==="horas"?[]:[...c[d].files];return{...c,[d]:{...c[d],files:[...u,...i]}}})},C=(a,d)=>{k(i=>{const c=[...i[a].files];return c.splice(d,1),{...i,[a]:{...i[a],files:c}}})},N=(a,d)=>{a.preventDefault(),a.stopPropagation(),a.type==="dragenter"||a.type==="dragover"?f(d):a.type==="dragleave"&&f(null)},j=(a,d)=>{a.preventDefault(),a.stopPropagation(),f(null),a.dataTransfer.files&&a.dataTransfer.files.length>0&&D(a.dataTransfer.files,d)},w=Q({mutationFn:async()=>{if(!o)throw new Error("ID de estudiante no disponible.");const a=Object.keys(h);if(h.horas.files.length===0)throw new Error("Falta la Planilla de Seguimiento.");if(h.asistencia.files.length===0)throw new Error("Falta la Planilla de Asistencia.");if(h.informe.files.length===0)throw new Error("Falta el Informe Final.");const d={};for(const i of a){const c=h[i];if(c.files.length===0)continue;k(u=>({...u,[i]:{...u[i],uploading:!0}}));const s=[];try{for(const u of c.files){const y=await X(u,o,i);s.push({url:y,filename:u.name})}d[i]=s,k(u=>({...u,[i]:{...u[i],uploading:!1,uploadedData:s}}))}catch(u){throw k(y=>({...y,[i]:{...y[i],uploading:!1}})),u}}return await ee(o,{informes:d.informe||[],horas:d.horas||[],asistencias:d.asistencia||[],sugerencias:S}),!0},onSuccess:()=>{l(!0),v.invalidateQueries({queryKey:["finalizacionRequest"]}),v.invalidateQueries({queryKey:["solicitudes"]}),r("Solicitud enviada con éxito. Se procesará tu acreditación.","success")},onError:a=>{console.error("Submission Error:",a);const d=a.message||"Error desconocido";r(`Error al enviar: ${d}. Revisa tu conexión e intenta nuevamente.`,"error")}}),E=async a=>{a.preventDefault(),g(!0);try{const{data:d,error:i}=await Y.storage.from("plantillas").download("Planilla_Seguimiento.xlsx");if(i)throw i;const c=window.URL.createObjectURL(d),s=document.createElement("a");s.href=c,s.download="Planilla_Seguimiento_PPS.xlsx",document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(c),r("Plantilla descargada.","success")}catch(d){console.error("Error descargando plantilla",d),r("No se pudo descargar la plantilla.","error")}finally{g(!1)}};if(t)return e.jsxs(G,{title:"Solicitud Recibida",icon:"check_circle",className:"border-emerald-200 dark:border-emerald-800 bg-emerald-50/50 dark:bg-emerald-900/10 shadow-none border",children:[e.jsx("div",{className:"dark:text-slate-200",children:e.jsx(L,{icon:"mark_email_read",title:"¡Documentación Enviada!",message:"Hemos recibido tus archivos correctamente. Tu solicitud está en proceso y el contador de acreditación está activo."})}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(T,{variant:"secondary",onClick:()=>n?n():window.location.reload(),children:"Volver al Inicio"})})]});const _=[{key:"horas",label:"Planilla de Seguimiento",desc:"Excel de seguimiento de horas completo.",icon:"schedule",iconColor:"text-blue-500",bgColor:"bg-blue-100 dark:bg-blue-900/30",hasTemplate:!0,allowsMultiple:!1},{key:"asistencia",label:"Planillas de Asistencia",desc:"Registros diarios de todas tus PPS presenciales. Puedes subir fotos o PDFs.",icon:"event_available",iconColor:"text-purple-500",bgColor:"bg-purple-100 dark:bg-purple-900/30",allowsMultiple:!0},{key:"informe",label:"Informes Finales",desc:"Informes de todas las prácticas. Puedes subir múltiples archivos.",icon:"description",iconColor:"text-emerald-500",bgColor:"bg-emerald-100 dark:bg-emerald-900/30",allowsMultiple:!0}];return e.jsxs("div",{className:"animate-fade-in-up h-full flex flex-col bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"p-5 border-b border-indigo-100 dark:border-slate-800 bg-indigo-50/50 dark:bg-slate-900/50 flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-white dark:bg-slate-800 text-indigo-600 dark:text-indigo-400 rounded-2xl shadow-sm border border-indigo-100 dark:border-slate-700",children:e.jsx("span",{className:"material-icons !text-2xl",children:"verified"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-black text-slate-900 dark:text-white tracking-tight",children:"Solicitud de Finalización"}),e.jsx("p",{className:"text-sm font-medium text-slate-500 dark:text-slate-400",children:"Adjunta la documentación para cerrar el ciclo."})]})]}),e.jsx("button",{onClick:n,className:"p-2 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-all",children:e.jsx("span",{className:"material-icons !text-xl",children:"close"})})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto p-6 space-y-6 custom-scrollbar",children:[_.map(a=>{const d=h[a.key],i=b===a.key,c=d.files.length>0;return e.jsx("div",{className:`
                            relative rounded-2xl border-2 transition-all duration-300 overflow-hidden
                            ${i?"border-blue-500 bg-blue-50/50 dark:bg-blue-900/20 shadow-lg scale-[1.01]":c?"border-emerald-200 dark:border-emerald-800/50 bg-white dark:bg-slate-800":"border-slate-100 dark:border-slate-800 bg-white dark:bg-slate-800 hover:border-blue-200 dark:hover:border-slate-600"}
                        `,children:e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-xl ${a.bgColor} ${a.iconColor}`,children:e.jsx("span",{className:"material-icons !text-xl",children:a.icon})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-800 dark:text-slate-200 text-sm",children:a.label}),a.hasTemplate&&e.jsxs("button",{onClick:E,disabled:x,className:"text-[10px] font-bold text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-0.5 mt-0.5",children:[x?"Descargando...":"Descargar plantilla",e.jsx("span",{className:"material-icons !text-[10px]",children:"download"})]})]})]}),c&&e.jsxs("span",{className:"text-[10px] font-bold bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400 px-2 py-0.5 rounded-full flex items-center gap-1",children:[e.jsx("span",{className:"material-icons !text-[12px]",children:"check"}),"Listo"]})]}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-4 pl-1",children:a.desc}),e.jsxs("div",{className:`
                                        rounded-xl border-2 border-dashed p-4 text-center cursor-pointer transition-colors
                                        ${i?"border-blue-400 bg-white/50 dark:bg-black/20":"border-slate-200 dark:border-slate-700 hover:border-blue-300 hover:bg-slate-50 dark:hover:bg-slate-700/30"}
                                    `,onDragEnter:s=>N(s,a.key),onDragLeave:s=>N(s,a.key),onDragOver:s=>N(s,a.key),onDrop:s=>j(s,a.key),onClick:()=>{var s;return(s=P[a.key].current)==null?void 0:s.click()},children:[e.jsx("input",{type:"file",ref:P[a.key],onChange:s=>D(s.target.files,a.key),className:"hidden",multiple:a.allowsMultiple,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.xls,.xlsx"}),e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:`material-icons !text-2xl ${i?"text-blue-500":"text-slate-300 dark:text-slate-600"}`,children:"cloud_upload"}),e.jsx("span",{className:"text-xs font-bold text-slate-600 dark:text-slate-300",children:i?"Suelta aquí":c?"Agregar más archivos":"Haz clic para subir"})]})]}),c&&e.jsx("div",{className:"mt-3 space-y-2",children:d.files.map((s,u)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-slate-50 dark:bg-slate-900/50 rounded-lg border border-slate-100 dark:border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[e.jsx("span",{className:"material-icons text-slate-400 !text-base shrink-0",children:"description"}),e.jsx("span",{className:"text-xs font-medium text-slate-700 dark:text-slate-300 truncate",children:s.name})]}),e.jsx("button",{onClick:()=>C(a.key,u),className:"p-1 text-slate-400 hover:text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/30 rounded transition-colors",children:e.jsx("span",{className:"material-icons !text-base",children:"close"})})]},u))})]})},a.key)}),e.jsxs("div",{className:"p-4 bg-amber-50 dark:bg-amber-900/10 rounded-2xl border border-amber-100 dark:border-amber-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"material-icons text-amber-500 !text-lg",children:"tips_and_updates"}),e.jsx("h3",{className:"text-amber-900 dark:text-amber-100 font-bold text-sm",children:"Espacio de sugerencias (Opcional)"})]}),e.jsx("textarea",{value:S,onChange:a=>m(a.target.value),rows:2,className:"w-full text-xs rounded-xl border border-amber-200 dark:border-amber-800/50 bg-white dark:bg-slate-900 p-3 outline-none focus:ring-2 focus:ring-amber-400 text-slate-700 dark:text-slate-200 placeholder:text-slate-400",placeholder:"¿Algo para mejorar en el proceso?"})]})]}),e.jsxs("div",{className:"p-5 border-t border-slate-200 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/50 flex flex-col sm:flex-row justify-end items-center gap-3",children:[w.isPending&&e.jsxs("span",{className:"text-xs font-bold text-slate-500 animate-pulse flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce"})," Subiendo archivos..."]}),e.jsxs("div",{className:"flex gap-3 w-full sm:w-auto",children:[e.jsx("button",{onClick:()=>n?n():window.location.reload(),className:"flex-1 sm:flex-none px-4 py-2.5 rounded-xl text-xs font-bold text-slate-500 hover:text-slate-700 hover:bg-slate-100 dark:text-slate-400 dark:hover:bg-slate-800 transition-colors",disabled:w.isPending,children:"Cancelar"}),e.jsx(T,{onClick:()=>w.mutate(),isLoading:w.isPending,disabled:h.horas.files.length===0||h.asistencia.files.length===0||h.informe.files.length===0,icon:"send",className:"flex-1 sm:flex-none shadow-lg hover:shadow-xl hover:-translate-y-0.5",children:"Finalizar"})]})]})]})},oe=({isOpen:o,onClose:n,onContinue:r,existingInstitutions:t})=>{const[l,x]=p.useState(""),g=p.useMemo(()=>{if(!l)return t;const b=I(l);return t.filter(f=>I(f).includes(b))},[t,l]);return o?e.jsx("div",{className:"fixed inset-0 z-[1300] flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4 animate-fade-in",onClick:n,children:e.jsxs("div",{onClick:b=>b.stopPropagation(),className:"relative w-[95vw] max-h-[85dvh] sm:w-full sm:max-w-2xl sm:max-h-[90vh] bg-white dark:bg-slate-900 rounded-2xl shadow-2xl flex flex-col border border-slate-200 dark:border-slate-800 overflow-hidden animate-scale-in",children:[e.jsxs("div",{className:"p-6 border-b border-slate-200 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 rounded-xl",children:e.jsx("span",{className:"material-icons !text-2xl",children:"warning_amber"})}),e.jsx("h2",{className:"text-xl font-black text-slate-900 dark:text-white tracking-tight",children:"Requisitos Previos"})]}),e.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-300 leading-relaxed",children:"Antes de iniciar una solicitud de autogestión, por favor verifica lo siguiente:"})]}),e.jsxs("div",{className:"p-6 overflow-y-auto custom-scrollbar space-y-6 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex gap-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded-xl items-start",children:[e.jsx("span",{className:"material-icons text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5",children:"psychology"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-blue-900 dark:text-blue-100 text-sm",children:"Supervisión Profesional"}),e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1 leading-relaxed",children:["Es requisito indispensable que la institución cuente con un"," ",e.jsx("strong",{children:"Licenciado/a en Psicología"})," en planta que pueda ejercer el rol de tutor/a y supervisar tu práctica."]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-slate-100 text-sm flex items-center gap-2",children:[e.jsx("span",{className:"material-icons text-emerald-500 !text-lg",children:"new_releases"}),"Solo para Nuevos Espacios"]}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1 leading-relaxed",children:["El objetivo de este trámite es la apertura de convenios en instituciones donde"," ",e.jsx("strong",{children:"no tenemos oferta actual"}),". Por favor, verifica que la institución que propones ",e.jsx("strong",{children:"NO"})," esté en el siguiente listado."]})]}),e.jsxs("div",{className:"border border-slate-200 dark:border-slate-700 rounded-xl overflow-hidden flex flex-col h-96",children:[e.jsx("div",{className:"p-3 bg-slate-50 dark:bg-slate-800/50 border-b border-slate-200 dark:border-slate-700 flex-shrink-0",children:e.jsx(ae,{placeholder:"Buscar institución en el listado actual...",icon:"search",value:l,onChange:b=>x(b.target.value),className:"bg-white dark:bg-slate-900"})}),e.jsx("div",{className:"overflow-y-auto p-2 bg-slate-50/30 dark:bg-slate-900/30 custom-scrollbar flex-grow",children:g&&g.length>0?e.jsx("ul",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:g.map((b,f)=>e.jsxs("li",{className:"text-xs px-3 py-2 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 flex items-center gap-2 truncate",title:b,children:[e.jsx("span",{className:"material-icons !text-sm text-slate-400 shrink-0",children:"apartment"}),e.jsx("span",{className:"truncate font-medium",children:b})]},f))}):e.jsx("p",{className:"text-center text-sm text-slate-500 py-10 italic font-medium",children:t.length===0?"Cargando lista de instituciones...":"No se encontraron instituciones con ese nombre en el listado actual."})})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-slate-200 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-900/50 flex justify-end gap-3 safe-area-bottom",children:[e.jsx(T,{variant:"secondary",onClick:n,children:"Cancelar"}),e.jsx(T,{onClick:r,icon:"arrow_forward",children:"Comprendido, Continuar"})]})]})}):null};export{te as A,de as F,oe as P,ne as S,le as a};
